# Enable rewrite engine
RewriteEngine On

# Force HTTPS (optional but recommended)
# RewriteCond %{HTTPS} off
# RewriteRule ^(.*)$ https://%{HTTP_HOST}/$1 [R=301,L]

# Set default charset
AddDefaultCharset UTF-8

# Enable index.html as directory index
DirectoryIndex index.html

# Disable directory browsing for security
Options -Indexes +FollowSymLinks

# ============================================
# Locale Routing Rules
# ============================================

# Handle root path - internally rewrite to /en/ (English default)
RewriteCond %{REQUEST_URI} ^/$
RewriteRule ^$ /en/ [L]

# Internally rewrite pages without locale prefix to English version
# This keeps URLs clean: /contact/, /projects/ (no /en shown in URL)
# But serves files from /en/contact/, /en/projects/
RewriteCond %{REQUEST_URI} !^/(en|ar|tr)(/|$)
RewriteCond %{REQUEST_URI} !^/_next(/|$)
RewriteCond %{REQUEST_URI} !^/404
RewriteCond %{REQUEST_URI} !^/_not-found
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{DOCUMENT_ROOT}/en%{REQUEST_URI} -d [OR]
RewriteCond %{DOCUMENT_ROOT}/en%{REQUEST_URI}/index.html -f
RewriteRule ^(.*)$ /en/$1 [L]

# ============================================
# Clean URL Support
# ============================================

# Remove .html extension from URLs
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME}\.html -f
RewriteRule ^(.+?)/?$ $1.html [L]

# Add trailing slash to directories (already handled by trailingSlash in Next.js config)
# This ensures /en/contact/ maps to /en/contact/index.html

# ============================================
# Handle trailing slashes for locale pages
# ============================================

# If accessing a directory without trailing slash and index.html exists, redirect
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_URI} !/$
RewriteCond %{REQUEST_FILENAME}/index.html -f
RewriteRule ^(.+)$ /$1/ [R=301,L]

# ============================================
# Error Pages
# ============================================

# Custom 404 page
ErrorDocument 404 /404.html

# Custom 403 page (optional)
# ErrorDocument 403 /403.html

# ============================================
# Security Headers
# ============================================

# Prevent clickjacking
Header always set X-Frame-Options "SAMEORIGIN"

# Prevent MIME type sniffing
Header always set X-Content-Type-Options "nosniff"

# Enable XSS protection
Header always set X-XSS-Protection "1; mode=block"

# ============================================
# Caching Rules for Performance
# ============================================

# Cache static assets
<FilesMatch "\.(jpg|jpeg|png|gif|ico|svg|webp|woff|woff2|ttf|eot|css|js)$">
  Header set Cache-Control "public, max-age=31536000, immutable"
</FilesMatch>

# Cache HTML pages for shorter duration
<FilesMatch "\.(html)$">
  Header set Cache-Control "public, max-age=3600, must-revalidate"
</FilesMatch>

# ============================================
# MIME Types
# ============================================

# Ensure proper MIME types for fonts
AddType font/woff2 .woff2
AddType font/woff .woff
AddType application/font-ttf .ttf
AddType application/font-otf .otf

# Ensure proper MIME types for other assets
AddType image/svg+xml .svg
AddType image/webp .webp
AddType application/javascript .js
AddType text/css .css
